(async function(){let k;const r=document.querySelector(".kanban-update-item-sidebar"),w=document.querySelector(".kanban-wrapper"),h=document.querySelector(".comment-editor"),u=document.querySelector(".kanban-add-new-board"),m=[].slice.call(document.querySelectorAll(".kanban-add-board-input")),A=document.querySelector(".kanban-add-board-btn"),y=document.querySelector("#due-date"),f=$(".select2"),g=document.querySelector("html").getAttribute("data-assets-path"),D=new bootstrap.Offcanvas(r),v=await fetch(g+"json/kanban.json");v.ok||console.error("error",v),k=await v.json(),y&&y.flatpickr({monthSelectorType:"static",altInput:!0,altFormat:"j F, Y",dateFormat:"Y-m-d"});//! TODO: Update Event label and guest code to JS once select removes jQuery dependency
if(f.length){let e=function(t){if(!t.id)return t.text;var a="<div class='badge "+$(t.element).data("color")+" rounded-pill'> "+t.text+"</div>";return a};var O=e;f.each(function(){var t=$(this);select2Focus(t),t.wrap("<div class='position-relative'></div>").select2({placeholder:"Select Label",dropdownParent:t.parent(),templateResult:e,templateSelection:e,escapeMarkup:function(a){return a}})})}h&&new Quill(h,{modules:{toolbar:".comment-toolbar"},placeholder:"Write a Comment... ",theme:"snow"});function S(){return"<div class='dropdown'><i class='dropdown-toggle mdi mdi-dots-vertical mdi-24px text-muted cursor-pointer' id='board-dropdown' data-bs-toggle='dropdown' aria-haspopup='true' aria-expanded='false'></i><div class='dropdown-menu dropdown-menu-end' aria-labelledby='board-dropdown'><a class='dropdown-item delete-board' href='javascript:void(0)'> <i class='mdi mdi-delete-outline'></i> <span class='align-middle'>Delete</span></a><a class='dropdown-item' href='javascript:void(0)'><i class='mdi mdi-rename-outline'></i> <span class='align-middle'>Rename</span></a><a class='dropdown-item' href='javascript:void(0)'><i class='mdi mdi-archive-outline'></i> <span class='align-middle'>Archive</span></a></div></div>"}function q(){return"<div class='dropdown kanban-tasks-item-dropdown'><i class='dropdown-toggle mdi mdi-dots-vertical' id='kanban-tasks-item-dropdown' data-bs-toggle='dropdown' aria-haspopup='true' aria-expanded='false'></i><div class='dropdown-menu dropdown-menu-end' aria-labelledby='kanban-tasks-item-dropdown'><a class='dropdown-item' href='javascript:void(0)'>Copy task link</a><a class='dropdown-item' href='javascript:void(0)'>Duplicate task</a><a class='dropdown-item delete-task' href='javascript:void(0)'>Delete</a></div></div>"}function H(e,t){return"<div class='d-flex justify-content-between flex-wrap align-items-center mb-2 pb-1'><div class='item-badges d-flex'> <div class='badge rounded-pill bg-label-"+e+"'> "+t+"</div></div>"+q()+"</div>"}function E(e,t,a,n,d){var s=t?" pull-up":"",i=a?"avatar-"+a:"",p=d==null?" ":d.split(",");return e==null?" ":e.split(",").map(function(o,c,F){var N=n&&c!==F.length-1?" me-"+n:"";return"<div class='avatar "+i+N+"'data-bs-toggle='tooltip' data-bs-placement='top'title='"+p[c]+"'><img src='"+g+"img/avatars/"+o+"' alt='Avatar' class='rounded-circle "+s+"'></div>"}).join(" ")}function M(e,t,a,n){return"<div class='d-flex justify-content-between align-items-center flex-wrap mt-2 pt-1'><div> <span class='align-middle me-2'><i class='mdi mdi-paperclip mdi-20px me-1'></i><small class='attachments'>"+e+"</small></span> <span class='align-middle'><i class='mdi mdi-message-outline mdi-20px me-1'></i><small> "+t+" </small></span></div><div class='avatar-group d-flex align-items-center assigned-avatar'>"+E(a,!0,"xs",null,n)+"</div></div>"}const l=new jKanban({element:".kanban-wrapper",gutter:"15px",widthBoard:"250px",dragItems:!0,boards:k,dragBoards:!0,addItemButton:!0,buttonContent:"+ Add Item",itemAddOptions:{enabled:!0,content:"+ Add New Item",class:"kanban-title-button btn btn-default btn-md shadow-none text-capitalize fw-normal",footer:!1},click:function(e){let t=e,a=t.getAttribute("data-eid")?t.querySelector(".kanban-text").textContent:t.textContent,n=t.getAttribute("data-due-date"),d=new Date,s=d.getFullYear(),i=n?n+", "+s:d.getDate()+" "+d.toLocaleString("en",{month:"long"})+", "+s,p=t.getAttribute("data-badge-text"),o=t.getAttribute("data-assigned");D.show(),r.querySelector("#title").value=a,r.querySelector("#due-date").nextSibling.value=i,$(".kanban-update-item-sidebar").find(f).val(p).trigger("change"),r.querySelector(".assigned").innerHTML="",r.querySelector(".assigned").insertAdjacentHTML("afterbegin",E(o,!1,"sm","2",e.getAttribute("data-members"))+"<div class='avatar avatar-sm ms-2'><span class='avatar-initial rounded-circle bg-label-secondary'><i class='mdi mdi-plus'></i></span></div>")},buttonClick:function(e,t){const a=document.createElement("form");a.setAttribute("class","new-item-form"),a.innerHTML='<div class="mb-3"><textarea class="form-control add-new-item" rows="3" placeholder="Add Content" autofocus required></textarea></div><div class="mb-3"><button type="submit" class="btn btn-primary btn-sm me-2">Add</button><button type="button" class="btn btn-outline-secondary btn-sm cancel-add-item">Cancel</button></div>',l.addForm(t,a),a.addEventListener("submit",function(n){n.preventDefault();const d=[].slice.call(document.querySelectorAll(".kanban-board[data-id="+t+"] .kanban-item"));l.addElement(t,{title:"<span class='kanban-text'>"+n.target[0].value+"</span>",id:t+"-"+d.length+1}),[].slice.call(document.querySelectorAll(".kanban-board[data-id="+t+"] .kanban-text")).forEach(function(o){o.insertAdjacentHTML("beforebegin",q())});const i=[].slice.call(document.querySelectorAll(".kanban-item .kanban-tasks-item-dropdown"));i&&i.forEach(function(o){o.addEventListener("click",function(c){c.stopPropagation()})}),[].slice.call(document.querySelectorAll(".kanban-board[data-id="+t+"] .delete-task")).forEach(function(o){o.addEventListener("click",function(){const c=this.closest(".kanban-item").getAttribute("data-eid");l.removeElement(c)})}),a.remove()}),a.querySelector(".cancel-add-item").addEventListener("click",function(n){a.remove()})}});w&&new PerfectScrollbar(w);const b=document.querySelector(".kanban-container"),L=[].slice.call(document.querySelectorAll(".kanban-title-board")),x=[].slice.call(document.querySelectorAll(".kanban-item"));x&&x.forEach(function(e){const t="<span class='kanban-text'>"+e.textContent+"</span>";let a="";e.getAttribute("data-image")!==null&&(a="<img class='img-fluid mb-2 rounded-3' src='"+g+"img/elements/"+e.getAttribute("data-image")+"'>"),e.textContent="",e.getAttribute("data-badge")!==void 0&&e.getAttribute("data-badge-text")!==void 0&&e.insertAdjacentHTML("afterbegin",H(e.getAttribute("data-badge"),e.getAttribute("data-badge-text"))+a+t),(e.getAttribute("data-comments")!==void 0||e.getAttribute("data-due-date")!==void 0||e.getAttribute("data-assigned")!==void 0)&&e.insertAdjacentHTML("beforeend",M(e.getAttribute("data-attachments"),e.getAttribute("data-comments"),e.getAttribute("data-assigned"),e.getAttribute("data-members")))}),[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)});const T=[].slice.call(document.querySelectorAll(".kanban-tasks-item-dropdown"));T&&T.forEach(function(e){e.addEventListener("click",function(t){t.stopPropagation()})}),A&&A.addEventListener("click",()=>{m.forEach(e=>{e.value="",e.classList.toggle("d-none")})}),b&&b.appendChild(u),L&&L.forEach(function(e){e.addEventListener("mouseenter",function(){this.contentEditable="true"}),e.insertAdjacentHTML("afterend",S())});const j=[].slice.call(document.querySelectorAll(".delete-board"));j&&j.forEach(function(e){e.addEventListener("click",function(){const t=this.closest(".kanban-board").getAttribute("data-id");l.removeBoard(t)})});const C=[].slice.call(document.querySelectorAll(".delete-task"));C&&C.forEach(function(e){e.addEventListener("click",function(){const t=this.closest(".kanban-item").getAttribute("data-eid");l.removeElement(t)})});const B=document.querySelector(".kanban-add-board-cancel-btn");B&&B.addEventListener("click",function(){m.forEach(e=>{e.classList.toggle("d-none")})}),u&&u.addEventListener("submit",function(e){e.preventDefault();const t=this,a=t.querySelector(".form-control").value,n=a.replace(/\s+/g,"-").toLowerCase();l.addBoards([{id:n,title:a}]);const d=document.querySelectorAll(".kanban-board:last-child")[0];d&&(d.querySelector(".kanban-title-board").insertAdjacentHTML("afterend",S()),d.querySelector(".kanban-title-board").addEventListener("mouseenter",function(){this.contentEditable="true"}));const s=d.querySelector(".delete-board");s&&s.addEventListener("click",function(){const i=this.closest(".kanban-board").getAttribute("data-id");l.removeBoard(i)}),m&&m.forEach(i=>{i.classList.add("d-none")}),b&&b.appendChild(u)}),r.addEventListener("hidden.bs.offcanvas",function(){r.querySelector(".ql-editor").firstElementChild.innerHTML=""}),r&&r.addEventListener("shown.bs.offcanvas",function(){[].slice.call(r.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(t){return new bootstrap.Tooltip(t)})})})();
